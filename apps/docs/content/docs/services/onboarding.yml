openapi: 3.1.1
info:
  title: Onboarding Services API
  description: |
    The Onboarding Services API provides biometric validation services for user registration and facial authentication verification.
    
    ## Features
    
    * **Facial Authentication**: Compare faces between images or templates
    * **Passive Liveness Detection**: Verify if a selfie image shows a live person
    * **Real-time Processing**: Fast response times for critical applications
    
  version: 1.0.0
  contact:
    name: FacePhi Support
    email: support@facephi.com
servers:
  - url: '{IDENTITY_API_BASE_URL}'
    description: Identity API Base URL
    variables:
      IDENTITY_API_BASE_URL:
        default: 'https://api.identity-platform.io'
security:
  - apiKey: []
tags:
  - name: Onboarding
    description: Biometric validation services for user registration
paths:
  '/services/evaluatePassiveLivenessToken':
    post:
      tags:
        - Onboarding
      summary: Evaluate Passive Liveness Token
      description: This service performs a liveness check using the best tokenized image obtained during the user's selfie capture. To generate the tokenized image, the native function of the Selphi widget is used, with the bestImage parameter (open image) generated by the widget.
      operationId: evaluatePassiveLivenessToken
      requestBody:
        description: Tokenized image data and tracking information for liveness evaluation
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PassiveLivenessTokenRequest'
            example:
              imageBuffer: "BAMBAQLNHJoWGPjfeuDIzDXdZuP/…"
              tracking:
                extraData: "BQABAQG2gBNjuHN..."
                operationId: "xxxxx-xxxxx-xxxxx-xxxxx-xxxxx"
      responses:
        '200':
          description: Successfully processed liveness evaluation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PassiveLivenessResponse'
              examples:
                Live:
                  summary: Live detection result
                  value:
                    serviceResultCode: 0
                    serviceResultLog: "Live"
                    serviceTime: "799"
                    serviceTransactionId: "35d93da8-b843-4033-8e78-c0aabedcef8b"
                    serviceLivenessResult: 3
                NoLive:
                  summary: No live detection result
                  value:
                    serviceResultCode: 0
                    serviceResultLog: "NoLive"
                    serviceTime: "81"
                    serviceTransactionId: "3f332c81-3dfa-4952-b593-20e3b5651b5b"
                    serviceLivenessResult: 0
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 400
                  title:
                    type: string
                    example: "Bad Request"
                  detail:
                    type: string
                    example: "Invalid request."
                  type:
                    type: string
                    example: "https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"
                  errors:
                    type: array
                    example: []
              example:
                status: 400
                title: "Bad Request"
                detail: "Invalid request."
                type: "https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"
                errors: []
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Unauthorized"
              example:
                message: "Unauthorized"
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  Message:
                    type: string
                    example: "User is not authorized to access this resource with an explicit deny"
              example:
                Message: "User is not authorized to access this resource with an explicit deny"
        '502':
          description: Bad Gateway
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 502
                  title:
                    type: string
                    example: "Bad Gateway"
                  detail:
                    type: string
                    example: "Server got an invalid response."
                  type:
                    type: string
                    example: "https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/502"
              example:
                status: 502
                title: "Bad Gateway"
                detail: "Server got an invalid response."
                type: "https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/502"
        '504':
          description: Gateway Timeout
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Endpoint request timed out"
              example:
                message: "Endpoint request timed out"
      security:
        - apiKey: []
  '/services/authenticateFacial':
    post:
      tags:
        - Onboarding
      summary: Authenticate Facial
      description: This service performs facial validation between two faces, including both open images and biometric templates. Supports various authentication methods including open images, biometric templates, and document photo tokens.
      operationId: authenticateFacial
      requestBody:
        description: Facial authentication data with images/tokens and method specification
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FacialAuthenticationRequest'
            example:
              token1: "BASE64_IMAGE_OR_TOKEN"
              token2: "BASE64_IMAGE_OR_TOKEN"
              method: 1
              tracking:
                extraData: "BQABAQG2gBNjuHN..."
                operationId: "xxxxx-xxxxx-xxxxx-xxxxx-xxxxx"
      responses:
        '200':
          description: Successfully processed facial authentication
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FacialAuthenticationResponse'
              example:
                serviceResultCode: 0
                serviceResultLog: "Positive"
                serviceTime: "516"
                serviceTransactionId: "a29cbe15-2b68-495f-b7eb-be985b21c486"
                serviceFacialAuthenticationHash: "47D0ACDCF08C348469C2F512BB59216B46DCD9B253822ED0E4EEAFCEB76AADD5AEF20CA31EC52D03EB290EBC91A6AD65FB0416F9EB2164D3854932153074289E"
                serviceFacialAuthenticationResult: 3
                serviceFacialSimilarityResult: 0.99153554
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 400
                  title:
                    type: string
                    example: "Bad Request"
                  detail:
                    type: string
                    example: "Invalid request."
                  type:
                    type: string
                    example: "https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"
                  errors:
                    type: array
                    example: []
              example:
                status: 400
                title: "Bad Request"
                detail: "Invalid request."
                type: "https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"
                errors: []
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Unauthorized"
              example:
                message: "Unauthorized"
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  Message:
                    type: string
                    example: "User is not authorized to access this resource with an explicit deny"
              example:
                Message: "User is not authorized to access this resource with an explicit deny"
        '502':
          description: Bad Gateway
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 502
                  title:
                    type: string
                    example: "Bad Gateway"
                  detail:
                    type: string
                    example: "Server got an invalid response."
                  type:
                    type: string
                    example: "https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/502"
              example:
                status: 502
                title: "Bad Gateway"
                detail: "Server got an invalid response."
                type: "https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/502"
        '504':
          description: Gateway Timeout
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Endpoint request timed out"
              example:
                message: "Endpoint request timed out"
      security:
        - apiKey: []
  '/services/finishTracking':
    post:
      tags:
        - Onboarding
      summary: Finish Tracking
      description: This service completes the tracking process and should be invoked upon completing all validations in the Onboarding or Authentication flows. When this service is integrated, invoking the closeSession method from the Mobile/Web SDK is not required.
      operationId: finishTracking
      requestBody:
        description: Tracking completion data with family type, status, and reason
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FinishTrackingRequest'
            example:
              family: "OnBoarding"
              status: "SUCCEEDED"
              reason: ""
              extraData: "string"
      responses:
        '200':
          description: Tracking process completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FinishTrackingResponse'
              example:
                trackingStatus: 201
                trackingMessage: "FinishTrackingEvent: Ok"
                transactionId: "123e4567-e89b-12d3-a456-426614174000"
                timestamp: "2023-05-01T12:34:56.789Z"
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 400
                  title:
                    type: string
                    example: "Bad Request"
                  detail:
                    type: string
                    example: "Invalid request."
                  type:
                    type: string
                    example: "https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"
                  errors:
                    type: array
                    example: []
              example:
                status: 400
                title: "Bad Request"
                detail: "Invalid request."
                type: "https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400"
                errors: []
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Unauthorized"
              example:
                message: "Unauthorized"
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  Message:
                    type: string
                    example: "User is not authorized to access this resource with an explicit deny"
              example:
                Message: "User is not authorized to access this resource with an explicit deny"
        '502':
          description: Bad Gateway
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 502
                  title:
                    type: string
                    example: "Bad Gateway"
                  detail:
                    type: string
                    example: "Server got an invalid response."
                  type:
                    type: string
                    example: "https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/502"
              example:
                status: 502
                title: "Bad Gateway"
                detail: "Server got an invalid response."
                type: "https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/502"
        '504':
          description: Gateway Timeout
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Endpoint request timed out"
              example:
                message: "Endpoint request timed out"
      security:
        - apiKey: []
components:
  securitySchemes:
    apiKey:
      type: apiKey
      in: header
      name: x-api-key
      description: API key for authentication
  schemas:
    PassiveLivenessTokenRequest:
      type: object
      required:
        - imageBuffer
      properties:
        imageBuffer:
          type: string
          format: byte
          description: BestImage property generated by the Selphi widget and tokenized using the widget's native function.
          example: "BAMBAQLNHJoWGPjfeuDIzDXdZuP/…"
        tracking:
          $ref: '#/components/schemas/TrackingInfo'
    TrackingInfo:
      type: object
      description: Object that represents necessary tracking information.
      properties:
        extraData:
          type: string
          format: byte
          description: Token generated by Mobile/Web SDK. Contains tokenized tracking information with Platform.
          example: "BQABAQG2gBNjuHN..."
        operationId:
          type: string
          description: Operation identifier generated by Mobile/Web SDK.
          example: "xxxxx-xxxxx-xxxxx-xxxxx-xxxxx"
    FacialAuthenticationRequest:
      type: object
      required:
        - token1
        - token2
        - method
      properties:
        token1:
          type: string
          format: byte
          description: Image used as reference for facial comparison. Depending on the method invoked, it can be the token generated by the SelphID widgets (document photo token), an open image, or a tokenized biometric template.
          example: "BASE64_IMAGE_OR_TOKEN"
        token2:
          type: string
          format: byte
          description: Image used for the comparison. It can be an open image or a tokenized biometric template.
          example: "BASE64_IMAGE_OR_TOKEN"
        method:
          type: integer
          description: |
            Indicates the comparison method invoked according to the following specification:

            | Method | Description | Input |
            | :--- | :--- | :--- |
            | 1 | Facial authentication using open images | token1: Base64, token2: Base64 |
            | 2 | Facial authentication using biometric templates | token1: templateRaw, token2: templateRaw |
            | 3 | Facial authentication using an open image and a biometric template | token1: Base64, token2: templateRaw |
            | 4 | Facial authentication using the token generated by the crop of the document photo and an open image | token1: tokenFaceImage, token2: Base64 |
            | 5 | Facial authentication using the token generated by the crop of the document photo and a biometric template | token1: tokenFaceImage, token2: templateRaw |
          enum: [1, 2, 3, 4, 5]
          example: 1
        tracking:
          $ref: '#/components/schemas/TrackingInfo'
    FacialAuthenticationResponse:
      type: object
      properties:
        serviceResultCode:
          type: integer
          description: Code indicating the overall result of the service execution. See [Service Result Code](/docs/services/serviceResultCodes#service-result-code)
          example: 0
        serviceTime:
          type: string
          description: Total processing time (milliseconds).
          example: "516"
        serviceFacialAuthenticationResult:
          type: integer
          description: Code indicating the result of the facial matching. See [Service Facial Authentication Result](/docs/services/serviceResultCodes#service-facial-authentication-result)
          example: 3
        serviceResultLog:
          type: string
          description: Descriptive field of the service execution result. Includes details when there is an error or exception in the module.
          example: "Positive"
        serviceFacialSimilarityResult:
          type: number
          format: float
          description: Value indicating the facial similarity between the face in the identity document photo and the selfie taken by the user. 1.0 = 100%
          example: 0.99153554
        serviceTransactionId:
          type: string
          description: Transaction identifier associated with the request processed by the API.
          example: "a29cbe15-2b68-495f-b7eb-be985b21c486"
        serviceFacialAuthenticationHash:
          type: string
          description: Integrity hash of the biometric template used in a positive or uncertain facial authentication. Only applicable in methods 2, 3, and 5.
          example: "47D0ACDCF08C348469C2F512BB59216B46DCD9B253822ED0E4EEAFCEB76AADD5AEF20CA31EC52D03EB290EBC91A6AD65FB0416F9EB2164D3854932153074289E"
    PassiveLivenessResponse:
      type: object
      properties:
        serviceResultCode:
          type: integer
          description: Code indicating the overall result of the service execution. See [Service Result Code](/docs/services/serviceResultCodes#service-result-code)
          example: 0
        serviceTime:
          type: string
          description: Total response time (milliseconds).
          example: "799"
        serviceLivenessResult:
          type: integer
          description: Code indicating the result of the passive liveness test evaluation. See [Service Liveness Result](/docs/services/serviceResultCodes#service-liveness-result)
          example: 3
        serviceResultLog:
          type: string
          description: Descriptive field of the service execution result. Includes details when there is an error or exception.
          example: "Live"
        serviceTransactionId:
          type: string
          description: Transaction identifier associated with the request processed by the API.
          example: "35d93da8-b843-4033-8e78-c0aabedcef8b"
    FinishTrackingRequest:
      type: object
      required:
        - family
        - status
        - reason
        - extraData
      properties:
        family:
          type: string
          description: Possible values for the tracking family type.
          enum: ["Authentication", "OnBoarding"]
          example: "OnBoarding"
        status:
          type: string
          description: Status of the tracking process completion.
          enum: ["SUCCEEDED", "DENIED", "ERROR", "CANCELLED", "BLACKLISTED"]
          example: "SUCCEEDED"
        reason:
          type: string
          description: Reason code for the tracking status.
          enum: ["", "DOCUMENT_VALIDATION_NOT_PASSED", "DOCUMENT_VALIDATION_ERROR", "FACIAL_AUTHENTICATION_NOT_PASSED", "FACIAL_LIVENESS_NOT_PASSED", "FACIAL_AUTHENTICATION_ERROR", "FACIAL_LIVENESS_ERROR", "BLACKLISTED_FACE_TEMPLATE", "ALREADY_REGISTERED", "MANUAL_STATUS_CHANGE", "SECURITY_SERVICE_ERROR", "SELPHID_INTERNAL_ERROR", "SELPHID_TIMEOUT", "SELPHI_TIMEOUT"]
          example: ""
        extraData:
          type: string
          description: Token generated by Mobile/Web SDK. Contains tokenized tracking information.
          example: "string"
    FinishTrackingResponse:
      type: object
      properties:
        trackingStatus:
          type: integer
          description: Code indicating the result of the tracking service execution. Value 201 indicates service processed without exceptions.
          example: 201
        trackingMessage:
          type: string
          description: Message indicating the result of the tracking service execution.
          example: "FinishTrackingEvent: Ok"
        transactionId:
          type: string
          description: Transaction identifier associated with the request processed by the API.
          example: "123e4567-e89b-12d3-a456-426614174000"
        timestamp:
          type: string
          format: date-time
          description: Timestamp (UTC) of the response in the format YYYY-MM-DDThh:mm:ss.SSSZ.
          example: "2023-05-01T12:34:56.789Z"